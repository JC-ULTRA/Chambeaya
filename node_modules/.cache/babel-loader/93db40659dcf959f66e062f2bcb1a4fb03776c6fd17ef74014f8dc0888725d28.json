{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport store from '@/store';\nimport axios from 'axios';\nimport ResultadosView from '@/views/ResultadosView';\nimport PageNotFoundView from '@/views/PageNotFoundView';\nimport HomeView from '@/views/HomeView';\nimport OfficialDocUpLoad from '@/views/OfficialDocUpLoadView';\nimport PaymentMethodsView from '@/views/PaymentMethodsView';\nimport GeneralDataView from '@/views/GeneralDataView';\nimport PostAdView from '@/views/PostAdView';\nconst routes = [{\n  path: '/',\n  name: 'home',\n  component: HomeView,\n  meta: {\n    allowedRoles: ['admin', 'regular']\n  }\n}, {\n  path: '/ui/payment',\n  name: 'payment',\n  component: PaymentMethodsView\n}, {\n  path: '/ui/general-data',\n  name: 'general-data',\n  component: GeneralDataView\n}, {\n  path: '/ui/official-doc',\n  name: 'official-doc',\n  component: OfficialDocUpLoad\n}, {\n  path: '/ui/terminos',\n  name: 'terminos',\n  component: TerminosCondicionesView\n}, {\n  path: '/ui/post',\n  name: 'post',\n  component: PostAdView\n}, {\n  path: '/ui/login',\n  name: 'login',\n  component: LoginView\n}, {\n  path: '/ui/producto/:id',\n  name: 'producto',\n  component: ProductoView\n}, {\n  path: '/ui/resultados',\n  name: 'resultados',\n  component: ResultadosView\n}, {\n  path: '/ui/register-page',\n  name: 'register-page',\n  component: RegisterView\n}, {\n  path: '/:pathMatch(.*)*',\n  name: 'NotFound',\n  component: PageNotFoundView\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  scrollBehavior: () => ({\n    y: 0\n  }),\n  routes\n});\nfunction parseJwt(token) {\n  var base64Url = token.split('.')[1];\n  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n  return JSON.parse(jsonPayload);\n}\nfunction checaJwt() {\n  //  var jwt = store.getters.getjwt;\n  var jwt = store.state.userData.jwt;\n  if (jwt && jwt !== undefined && jwt.length > 0) {\n    const jwtPayload = parseJwt(jwt);\n    //jwtPayload.exp=1625505833-28*60;\n    let now = new Date();\n    let limite = new Date(jwtPayload.creation);\n    limite.setMinutes(limite.getMinutes() + 30);\n    if (now > limite) {\n      store.commit('setUserData', {\n        userData: {\n          idUser: 0,\n          nick: 'cyz',\n          email: '',\n          role: '',\n          lastSuccesfullAccess: '',\n          jwt: '',\n          //  jwt='' => signed: false,\n          usuarioDetalle: null\n        }\n      });\n      store.commit('setDestination', '/');\n    } else {\n      //const timeToExpire =  jwtPayload.exp - (Date.now()/1000);\n      //console.log('Tiempo para que expire:' + timeToExpire);\n    }\n  }\n}\nrouter.beforeEach((to, from, next) => {\n  axios.defaults.headers.common = {\n    \"X-CSRFToken\": store.state.userData.jwt\n  };\n  axios.defaults.headers.common = {\n    \"jwt\": store.state.userData.jwt\n  };\n  checaJwt();\n  //TODO: VALIDAR  EL JWT porque no tiene el valor de expire\n  if (to.matched.some(record => record.meta.allowedRoles)) {\n    // *** El recurso SI requiere autenticación ya que pide ciertos roles\n    // NO estás autenticado actualmente:\n    if (store.state.userData.jwt === '' || store.state.userData.jwt == undefined) {\n      store.commit('setDestination', to.fullPath);\n      router.push(\"/ui/login\");\n      return;\n    }\n    // SI estoy autenticado actualmente, asi que solo voy a checar si mi rol es el adecuado:              \n    if (to.matched.some(ok => !ok.meta.allowedRoles.includes(store.state.userData.role))) {\n      router.push('/ui/forbidden'); // no tengo el rol asociado a esa interfaz\n      return;\n    }\n  }\n  next(); // *** El recurso NO requiere autenticación\n});\n\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","store","axios","ResultadosView","PageNotFoundView","HomeView","OfficialDocUpLoad","PaymentMethodsView","GeneralDataView","PostAdView","routes","path","name","component","meta","allowedRoles","TerminosCondicionesView","LoginView","ProductoView","RegisterView","router","history","scrollBehavior","y","parseJwt","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","checaJwt","jwt","state","userData","undefined","length","jwtPayload","now","Date","limite","creation","setMinutes","getMinutes","commit","idUser","nick","email","role","lastSuccesfullAccess","usuarioDetalle","beforeEach","to","from","next","defaults","headers","common","matched","some","record","fullPath","push","ok","includes"],"sources":["/home/ubuntu/development/code/Proyecto Chambeaya/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport store from '@/store'\nimport axios from 'axios';\n\n\nimport ResultadosView from '@/views/ResultadosView'\nimport PageNotFoundView from '@/views/PageNotFoundView'\nimport HomeView from '@/views/HomeView'\n\nimport OfficialDocUpLoad from '@/views/OfficialDocUpLoadView'\nimport PaymentMethodsView from '@/views/PaymentMethodsView'\nimport GeneralDataView from '@/views/GeneralDataView'\nimport PostAdView from '@/views/PostAdView'\n\nconst routes = [\n  {\n    path: '/',\n    name: 'home',\n    component: HomeView,\n    meta: { allowedRoles: ['admin','regular'] }\n  },\n  {\n    path: '/ui/payment',\n    name: 'payment',\n    component: PaymentMethodsView\n  },\n  {\n    path: '/ui/general-data',\n    name: 'general-data',\n    component: GeneralDataView\n  },\n  {\n    path: '/ui/official-doc',\n    name: 'official-doc',\n    component: OfficialDocUpLoad\n  },\n  {\n    path: '/ui/terminos',\n    name: 'terminos',\n    component: TerminosCondicionesView\n  },\n  {\n    path: '/ui/post',\n    name: 'post',\n    component: PostAdView\n  },\n  {\n    path: '/ui/login',\n    name: 'login',\n    component: LoginView\n  },\n  {\n    path: '/ui/producto/:id',\n    name: 'producto',\n    component: ProductoView\n  },\n  {\n    path: '/ui/resultados',\n    name: 'resultados',\n    component: ResultadosView\n  },  \n  {\n    path: '/ui/register-page',\n    name: 'register-page',\n    component: RegisterView\n  },  \n  { path: '/:pathMatch(.*)*',\n    name: 'NotFound',\n    component: PageNotFoundView\n  },\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  scrollBehavior: () => ({ y: 0 }),\n  routes\n})\n\nfunction parseJwt(token) {\n  var base64Url = token.split('.')[1];\n  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\n      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n  return JSON.parse(jsonPayload);\n}\n\nfunction checaJwt() {\n//  var jwt = store.getters.getjwt;\n  var jwt = store.state.userData.jwt;\n  if (jwt && jwt !== undefined && jwt.length > 0) {\n      const jwtPayload = parseJwt(jwt);\n      //jwtPayload.exp=1625505833-28*60;\n      let now = new Date();\n      let limite = new Date (jwtPayload.creation);\n      limite.setMinutes(limite.getMinutes() + 30);\n      if (now> limite) {\n          store.commit('setUserData', {\n              userData: {\n                idUser: 0,\n                nick: 'cyz',\n                email: '',\n                role: '',\n                lastSuccesfullAccess: '',\n                jwt: '', //  jwt='' => signed: false,\n                usuarioDetalle: null,\n            },\n          });\n          store.commit('setDestination', '/');\n      } else {\n          //const timeToExpire =  jwtPayload.exp - (Date.now()/1000);\n          //console.log('Tiempo para que expire:' + timeToExpire);\n      }\n  }\n}\n\nrouter.beforeEach((to, from, next) => {\n  axios.defaults.headers.common = {\"X-CSRFToken\": store.state.userData.jwt};\n  axios.defaults.headers.common = {\"jwt\": store.state.userData.jwt};\n  checaJwt();\n  //TODO: VALIDAR  EL JWT porque no tiene el valor de expire\n  if (to.matched.some(record => record.meta.allowedRoles )) { // *** El recurso SI requiere autenticación ya que pide ciertos roles\n    // NO estás autenticado actualmente:\n    if (store.state.userData.jwt===''|| store.state.userData.jwt == undefined) {      \n      store.commit('setDestination', to.fullPath);\n      router.push(\"/ui/login\");\n      return;\n    }\n    // SI estoy autenticado actualmente, asi que solo voy a checar si mi rol es el adecuado:              \n    if(to.matched.some(ok => !ok.meta.allowedRoles.includes(store.state.userData.role))) {\n      router.push('/ui/forbidden'); // no tengo el rol asociado a esa interfaz\n      return;\n    }\n  }\n  next(); // *** El recurso NO requiere autenticación\n})\n\nexport default router\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}