{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport store from '@/store';\nimport axios from 'axios';\nimport RegisterView from '@/views/RegisterView';\nimport RegisterConfirmView from '@/views/RegisterConfirmView';\nimport ForbiddenView from '@/views/ForbiddenView';\nimport ForgotPassView from '@/views/ForgotPassView';\nimport ForgotConfirmView from '@/views/ForgotConfirmView';\nimport LoginView from '@/views/LoginView';\nimport OfficialDocUpLoad from '@/views/OfficialDocUpLoadView';\nimport PaymentMethodsView from '@/views/PaymentMethodsView';\nimport GeneralDataView from '@/views/GeneralDataView';\nimport PostAdView from '@/views/PostAdView';\nimport TermsConditionsView from '@/views/TermsConditionsView';\nimport MainMenuView from '@/views/MainMenuView';\nimport HomeView from \"@/views/HomeView\";\nimport UploadImageView from \"@/views/UploadImageView\";\nconst routes = [{\n  path: \"/\",\n  name: \"home\",\n  component: HomeView,\n  meta: {\n    allowedRoles: [\"admin\", \"regular\"],\n    nick: store.state.userData.nick // add this line to include the nick property\n  }\n}, {\n  path: '/ui/payment',\n  name: 'payment',\n  component: PaymentMethodsView\n}, {\n  path: '/ui/upload',\n  name: 'upload',\n  component: UploadImageView\n}, {\n  path: '/ui/general-data',\n  name: 'general-data',\n  component: GeneralDataView\n}, {\n  path: '/ui/official-doc',\n  name: 'official-doc',\n  component: OfficialDocUpLoad\n}, {\n  path: '/ui/post',\n  name: 'post',\n  component: PostAdView\n}, {\n  path: '/ui/login',\n  name: 'login',\n  component: LoginView\n}, {\n  path: '/ui/forgot-confirm',\n  name: 'forgot-confirm',\n  component: ForgotConfirmView\n}, {\n  path: '/ui/forgot',\n  name: 'forgot',\n  component: ForgotPassView\n}, {\n  path: '/ui/forbidden',\n  name: 'forbidden',\n  component: ForbiddenView\n}, {\n  path: '/ui/register-confirm',\n  name: 'register-confirm',\n  component: RegisterConfirmView\n}, {\n  path: '/ui/register',\n  name: 'register',\n  component: RegisterView\n}, {\n  path: '/ui/terms',\n  name: 'terms',\n  component: TermsConditionsView\n}, {\n  path: '/ui/main',\n  name: 'main',\n  component: MainMenuView\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  scrollBehavior: () => ({\n    y: 0\n  }),\n  routes\n});\nfunction parseJwt(token) {\n  var base64Url = token.split('.')[1];\n  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n  return JSON.parse(jsonPayload);\n}\nfunction checaJwt() {\n  //  var jwt = store.getters.getjwt;\n  var jwt = store.state.userData.jwt;\n  if (jwt && jwt !== undefined && jwt.length > 0) {\n    const jwtPayload = parseJwt(jwt);\n    //jwtPayload.exp=1625505833-28*60;\n    let now = new Date();\n    let limite = new Date(jwtPayload.creation);\n    limite.setMinutes(limite.getMinutes() + 30);\n    if (now > limite) {\n      store.commit('setUserData', {\n        userData: {\n          idUser: 0,\n          nick: 'cyz',\n          email: '',\n          role: '',\n          lastSuccesfullAccess: '',\n          jwt: '',\n          //  jwt='' => signed: false,\n          usuarioDetalle: null\n        }\n      });\n      store.commit('setDestination', '/');\n    } else {\n      //const timeToExpire =  jwtPayload.exp - (Date.now()/1000);\n      //console.log('Tiempo para que expire:' + timeToExpire);\n    }\n  }\n}\nrouter.beforeEach((to, from, next) => {\n  axios.defaults.headers.common = {\n    \"X-CSRFToken\": store.state.userData.jwt\n  };\n  axios.defaults.headers.common = {\n    \"jwt\": store.state.userData.jwt\n  };\n  checaJwt();\n  //TODO: VALIDAR  EL JWT porque no tiene el valor de expire\n  if (to.matched.some(record => record.meta.allowedRoles)) {\n    // *** El recurso SI requiere autenticación ya que pide ciertos roles\n    // NO estás autenticado actualmente:\n    if (store.state.userData.jwt === '' || store.state.userData.jwt == undefined) {\n      store.commit('setDestination', to.fullPath);\n      router.push(\"/ui/login\");\n      return;\n    }\n    // SI estoy autenticado actualmente, asi que solo voy a checar si mi rol es el adecuado:              \n    if (to.matched.some(ok => !ok.meta.allowedRoles.includes(store.state.userData.role))) {\n      router.push('/ui/forbidden'); // no tengo el rol asociado a esa interfaz\n      return;\n    }\n  }\n  next(); // *** El recurso NO requiere autenticación\n});\n\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","store","axios","RegisterView","RegisterConfirmView","ForbiddenView","ForgotPassView","ForgotConfirmView","LoginView","OfficialDocUpLoad","PaymentMethodsView","GeneralDataView","PostAdView","TermsConditionsView","MainMenuView","HomeView","UploadImageView","routes","path","name","component","meta","allowedRoles","nick","state","userData","router","history","scrollBehavior","y","parseJwt","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","checaJwt","jwt","undefined","length","jwtPayload","now","Date","limite","creation","setMinutes","getMinutes","commit","idUser","email","role","lastSuccesfullAccess","usuarioDetalle","beforeEach","to","from","next","defaults","headers","common","matched","some","record","fullPath","push","ok","includes"],"sources":["/home/ubuntu/development/code/Proyecto Chambeaya/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport store from '@/store'\nimport axios from 'axios';\n\nimport RegisterView from '@/views/RegisterView'\nimport RegisterConfirmView from '@/views/RegisterConfirmView'\nimport ForbiddenView from '@/views/ForbiddenView'\nimport ForgotPassView from '@/views/ForgotPassView'\nimport ForgotConfirmView from '@/views/ForgotConfirmView'\nimport LoginView from '@/views/LoginView'\nimport OfficialDocUpLoad from '@/views/OfficialDocUpLoadView'\nimport PaymentMethodsView from '@/views/PaymentMethodsView'\nimport GeneralDataView from '@/views/GeneralDataView'\nimport PostAdView from '@/views/PostAdView'\nimport TermsConditionsView from '@/views/TermsConditionsView'\nimport MainMenuView from '@/views/MainMenuView'\nimport HomeView from \"@/views/HomeView\";\nimport UploadImageView from \"@/views/UploadImageView\";\n\nconst routes = [\n\n  {\n    path: \"/\",\n    name: \"home\",\n    component: HomeView,\n    meta: {\n      allowedRoles: [\"admin\", \"regular\"],\n      nick: store.state.userData.nick // add this line to include the nick property\n    }\n  },\n  {\n    path: '/ui/payment',\n    name: 'payment',\n    component: PaymentMethodsView\n  },\n  {\n    path: '/ui/upload',\n    name: 'upload',\n    component: UploadImageView\n  },\n  {\n    path: '/ui/general-data',\n    name: 'general-data',\n    component: GeneralDataView\n  },\n  {\n    path: '/ui/official-doc',\n    name: 'official-doc',\n    component: OfficialDocUpLoad\n  },\n  {\n    path: '/ui/post',\n    name: 'post',\n    component: PostAdView\n  },\n  {\n    path: '/ui/login',\n    name: 'login',\n    component: LoginView\n  },\n  {\n    path: '/ui/forgot-confirm',\n    name: 'forgot-confirm',\n    component: ForgotConfirmView\n  },\n  {\n    path: '/ui/forgot',\n    name: 'forgot',\n    component: ForgotPassView\n  },\n  {\n    path: '/ui/forbidden',\n    name: 'forbidden',\n    component: ForbiddenView\n  },\n  {\n    path: '/ui/register-confirm',\n    name: 'register-confirm',\n    component: RegisterConfirmView\n  },\n  {\n    path: '/ui/register',\n    name: 'register',\n    component: RegisterView\n  },\n  {\n    path: '/ui/terms',\n    name: 'terms',\n    component: TermsConditionsView\n  },\n  {\n    path: '/ui/main',\n    name: 'main',\n    component: MainMenuView\n  },\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  scrollBehavior: () => ({ y: 0 }),\n  routes\n})\n\nfunction parseJwt(token) {\n  var base64Url = token.split('.')[1];\n  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n  return JSON.parse(jsonPayload);\n}\n\nfunction checaJwt() {\n  //  var jwt = store.getters.getjwt;\n  var jwt = store.state.userData.jwt;\n  if (jwt && jwt !== undefined && jwt.length > 0) {\n    const jwtPayload = parseJwt(jwt);\n    //jwtPayload.exp=1625505833-28*60;\n    let now = new Date();\n    let limite = new Date(jwtPayload.creation);\n    limite.setMinutes(limite.getMinutes() + 30);\n    if (now > limite) {\n      store.commit('setUserData', {\n        userData: {\n          idUser: 0,\n          nick: 'cyz',\n          email: '',\n          role: '',\n          lastSuccesfullAccess: '',\n          jwt: '', //  jwt='' => signed: false,\n          usuarioDetalle: null,\n        },\n      });\n      store.commit('setDestination', '/');\n    } else {\n      //const timeToExpire =  jwtPayload.exp - (Date.now()/1000);\n      //console.log('Tiempo para que expire:' + timeToExpire);\n    }\n  }\n}\n\nrouter.beforeEach((to, from, next) => {\n  axios.defaults.headers.common = { \"X-CSRFToken\": store.state.userData.jwt };\n  axios.defaults.headers.common = { \"jwt\": store.state.userData.jwt };\n  checaJwt();\n  //TODO: VALIDAR  EL JWT porque no tiene el valor de expire\n  if (to.matched.some(record => record.meta.allowedRoles)) { // *** El recurso SI requiere autenticación ya que pide ciertos roles\n    // NO estás autenticado actualmente:\n    if (store.state.userData.jwt === '' || store.state.userData.jwt == undefined) {\n      store.commit('setDestination', to.fullPath);\n      router.push(\"/ui/login\");\n      return;\n    }\n    // SI estoy autenticado actualmente, asi que solo voy a checar si mi rol es el adecuado:              \n    if (to.matched.some(ok => !ok.meta.allowedRoles.includes(store.state.userData.role))) {\n      router.push('/ui/forbidden'); // no tengo el rol asociado a esa interfaz\n      return;\n    }\n  }\n  next(); // *** El recurso NO requiere autenticación\n})\n\nexport default router\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}