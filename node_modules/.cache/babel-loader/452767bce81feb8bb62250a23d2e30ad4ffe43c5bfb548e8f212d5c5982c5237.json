{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport store from '@/store';\nimport axios from 'axios';\nimport ForbiddenView from '@/views/ForbiddenView';\nimport ResultadosView from '@/views/ResultadosView';\nimport PageNotFoundView from '@/views/PageNotFoundView';\nimport HomeView from '@/views/HomeView';\nimport ProductoView from '@/views/ProductoView';\nimport ForgotPassView from '@/views/ForgotPassView';\nimport RegisterView from '@/views/RegisterView';\nimport LoginView from '@/views/LoginView';\nimport EditImagesView from '@/views/EditImagesView';\nimport ShowAllImagesView from '@/views/ShowAllImagesView';\nimport OfficialDocUpLoad from '@/views/OfficialDocUpLoad';\nconst routes = [{\n  path: '/',\n  name: 'home',\n  component: HomeView,\n  meta: {\n    allowedRoles: ['admin', 'regular']\n  }\n}, {\n  path: '/ui/document-up',\n  name: 'document',\n  component: O\n}, {\n  path: '/ui/edit',\n  name: 'edit',\n  component: EditImagesView\n}, {\n  path: '/ui/producto',\n  name: 'producto',\n  component: ProductoView\n}, {\n  path: '/ui/show',\n  name: 'show',\n  component: ShowAllImagesView\n}, {\n  path: '/ui/login',\n  name: 'login',\n  component: LoginView\n}, {\n  path: '/ui/producto/:id',\n  name: 'producto',\n  component: ProductoView\n}, {\n  path: '/ui/resultados',\n  name: 'resultados',\n  component: ResultadosView\n}, {\n  path: '/ui/forbidden',\n  name: 'forbidden',\n  component: ForbiddenView\n}, {\n  path: '/ui/forgotpass',\n  name: 'forgotpass',\n  component: ForgotPassView\n}, {\n  path: '/ui/register-page',\n  name: 'register-page',\n  component: RegisterView\n}, {\n  path: '/:pathMatch(.*)*',\n  name: 'NotFound',\n  component: PageNotFoundView\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  scrollBehavior: () => ({\n    y: 0\n  }),\n  routes\n});\nfunction parseJwt(token) {\n  var base64Url = token.split('.')[1];\n  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n  return JSON.parse(jsonPayload);\n}\nfunction checaJwt() {\n  //  var jwt = store.getters.getjwt;\n  var jwt = store.state.userData.jwt;\n  if (jwt && jwt !== undefined && jwt.length > 0) {\n    const jwtPayload = parseJwt(jwt);\n    //jwtPayload.exp=1625505833-28*60;\n    let now = new Date();\n    let limite = new Date(jwtPayload.creation);\n    limite.setMinutes(limite.getMinutes() + 30);\n    if (now > limite) {\n      store.commit('setUserData', {\n        userData: {\n          idUser: 0,\n          nick: 'cyz',\n          email: '',\n          role: '',\n          lastSuccesfullAccess: '',\n          jwt: '',\n          //  jwt='' => signed: false,\n          usuarioDetalle: null\n        }\n      });\n      store.commit('setDestination', '/');\n    } else {\n      //const timeToExpire =  jwtPayload.exp - (Date.now()/1000);\n      //console.log('Tiempo para que expire:' + timeToExpire);\n    }\n  }\n}\nrouter.beforeEach((to, from, next) => {\n  axios.defaults.headers.common = {\n    \"X-CSRFToken\": store.state.userData.jwt\n  };\n  axios.defaults.headers.common = {\n    \"jwt\": store.state.userData.jwt\n  };\n  checaJwt();\n  //TODO: VALIDAR  EL JWT porque no tiene el valor de expire\n  if (to.matched.some(record => record.meta.allowedRoles)) {\n    // *** El recurso SI requiere autenticación ya que pide ciertos roles\n    // NO estás autenticado actualmente:\n    if (store.state.userData.jwt === '' || store.state.userData.jwt == undefined) {\n      store.commit('setDestination', to.fullPath);\n      router.push(\"/ui/login\");\n      return;\n    }\n    // SI estoy autenticado actualmente, asi que solo voy a checar si mi rol es el adecuado:              \n    if (to.matched.some(ok => !ok.meta.allowedRoles.includes(store.state.userData.role))) {\n      router.push('/ui/forbidden'); // no tengo el rol asociado a esa interfaz\n      return;\n    }\n  }\n  next(); // *** El recurso NO requiere autenticación\n});\n\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","store","axios","ForbiddenView","ResultadosView","PageNotFoundView","HomeView","ProductoView","ForgotPassView","RegisterView","LoginView","EditImagesView","ShowAllImagesView","OfficialDocUpLoad","routes","path","name","component","meta","allowedRoles","O","router","history","scrollBehavior","y","parseJwt","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","checaJwt","jwt","state","userData","undefined","length","jwtPayload","now","Date","limite","creation","setMinutes","getMinutes","commit","idUser","nick","email","role","lastSuccesfullAccess","usuarioDetalle","beforeEach","to","from","next","defaults","headers","common","matched","some","record","fullPath","push","ok","includes"],"sources":["/home/ubuntu/development/code/Proyecto Chambeaya/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport store from '@/store'\nimport axios from 'axios';\n\nimport ForbiddenView from '@/views/ForbiddenView'\nimport ResultadosView from '@/views/ResultadosView'\nimport PageNotFoundView from '@/views/PageNotFoundView'\nimport HomeView from '@/views/HomeView'\nimport ProductoView from '@/views/ProductoView'\nimport ForgotPassView from '@/views/ForgotPassView'\nimport RegisterView from '@/views/RegisterView'\nimport LoginView from '@/views/LoginView'\nimport EditImagesView from '@/views/EditImagesView'\nimport ShowAllImagesView from '@/views/ShowAllImagesView'\nimport OfficialDocUpLoad from '@/views/OfficialDocUpLoad'\n\nconst routes = [\n  {\n    path: '/',\n    name: 'home',\n    component: HomeView,\n    meta: { allowedRoles: ['admin','regular'] }\n  },\n  {\n    path: '/ui/document-up',\n    name: 'document',\n    component: O\n  },\n  {\n    path: '/ui/edit',\n    name: 'edit',\n    component: EditImagesView\n  },\n  {\n    path: '/ui/producto',\n    name: 'producto',\n    component: ProductoView\n  },\n  {\n    path: '/ui/show',\n    name: 'show',\n    component: ShowAllImagesView\n  },\n  {\n    path: '/ui/login',\n    name: 'login',\n    component: LoginView\n  },\n  {\n    path: '/ui/producto/:id',\n    name: 'producto',\n    component: ProductoView\n  },\n  {\n    path: '/ui/resultados',\n    name: 'resultados',\n    component: ResultadosView\n  },\n  {\n    path: '/ui/forbidden',\n    name: 'forbidden',\n    component: ForbiddenView\n  },\n  {\n    path: '/ui/forgotpass',\n    name: 'forgotpass',\n    component: ForgotPassView\n  },  \n  {\n    path: '/ui/register-page',\n    name: 'register-page',\n    component: RegisterView\n  },  \n  { path: '/:pathMatch(.*)*',\n    name: 'NotFound',\n    component: PageNotFoundView\n  },\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  scrollBehavior: () => ({ y: 0 }),\n  routes\n})\n\nfunction parseJwt(token) {\n  var base64Url = token.split('.')[1];\n  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\n      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n  }).join(''));\n  return JSON.parse(jsonPayload);\n}\n\nfunction checaJwt() {\n//  var jwt = store.getters.getjwt;\n  var jwt = store.state.userData.jwt;\n  if (jwt && jwt !== undefined && jwt.length > 0) {\n      const jwtPayload = parseJwt(jwt);\n      //jwtPayload.exp=1625505833-28*60;\n      let now = new Date();\n      let limite = new Date (jwtPayload.creation);\n      limite.setMinutes(limite.getMinutes() + 30);\n      if (now> limite) {\n          store.commit('setUserData', {\n              userData: {\n                idUser: 0,\n                nick: 'cyz',\n                email: '',\n                role: '',\n                lastSuccesfullAccess: '',\n                jwt: '', //  jwt='' => signed: false,\n                usuarioDetalle: null,\n            },\n          });\n          store.commit('setDestination', '/');\n      } else {\n          //const timeToExpire =  jwtPayload.exp - (Date.now()/1000);\n          //console.log('Tiempo para que expire:' + timeToExpire);\n      }\n  }\n}\n\nrouter.beforeEach((to, from, next) => {\n  axios.defaults.headers.common = {\"X-CSRFToken\": store.state.userData.jwt};\n  axios.defaults.headers.common = {\"jwt\": store.state.userData.jwt};\n  checaJwt();\n  //TODO: VALIDAR  EL JWT porque no tiene el valor de expire\n  if (to.matched.some(record => record.meta.allowedRoles )) { // *** El recurso SI requiere autenticación ya que pide ciertos roles\n    // NO estás autenticado actualmente:\n    if (store.state.userData.jwt===''|| store.state.userData.jwt == undefined) {      \n      store.commit('setDestination', to.fullPath);\n      router.push(\"/ui/login\");\n      return;\n    }\n    // SI estoy autenticado actualmente, asi que solo voy a checar si mi rol es el adecuado:              \n    if(to.matched.some(ok => !ok.meta.allowedRoles.includes(store.state.userData.role))) {\n      router.push('/ui/forbidden'); // no tengo el rol asociado a esa interfaz\n      return;\n    }\n  }\n  next(); // *** El recurso NO requiere autenticación\n})\n\nexport default router\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}